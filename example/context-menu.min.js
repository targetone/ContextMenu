function getUniqueID(t){do{t+=~~(1e6*Math.random())}while(document.getElementById(t));return t}class ContextMenu{constructor(t,e=""){this._name=getUniqueID("context-menu"),this._selector=t,this._exclude=e,this._itemName=[],this._itemAction=[],this._itemClass=[]}get name(){return this._name}get selector(){return this._selector}set selector(t){0!=t.length&&(this._selector=t)}get exclude(){return this._exclude}set exclude(t){0!=t.length&&(this._exclude=t)}get items(){let t=["name","action","class"],e=this._itemName,n=this._itemAction,i=this._itemClass,o=[],s={};return this._itemAction.forEach(function(c,a){s[t[0]]=e[a],s[t[1]]=n[a],s[t[2]]=i[a],o.push(s),s={}}),o}addItem(t,e,n=""){if(this._itemAction.indexOf(e)>=0)throw new Error("There is already one '"+e+"' in the action list.");this._itemName.push(t),this._itemAction.push(e),this._itemClass.push(n)}removeItem(t){let e=this._itemAction.indexOf(t);e>=0&&(this._itemName.splice(e,1),this._itemAction.splice(e,1),this._itemClass.splice(e,1))}initiate(){var t="context-menu__link",e="context-menu--active";let n=$("<nav></nav>"),i=$("<ul></ul>"),o=this._name,s=$("*[id*='"+o+"']");s.length>0&&(o+="-"+(s.length+1));for(var c=0;c<this._itemAction.length;c++){let e=$("<li></li>"),n=$("<span></p>");e.addClass("context-menu__item"),n.addClass(t),n.addClass(this._itemClass[c]),n.attr("data-action",this._itemAction[c]),n.text(this._itemName[c]),e.append(n),i.append(e)}function a(t,e){var n=t.srcElement||t.target;if($(n).is(g))return!1;if($(n).is(e))return n;for(;n=n.parentNode;){if($(n).is(g))return!1;if($(n).is(e))return n}return!1}var r;n.attr("id",o),n.addClass("context-menu"),i.addClass("context-menu__items"),n.append(i),this._itemAction.length>0?$("body").append(n):$("body").append($("<div class='d-none'></div>"));var l,u,d,m,h,f,_,p=this._selector,g=this._exclude,x=$("#"+o),v=x.find($(".context-menu__item")),w=0;function C(n){r=a(n,p),($.contains(x[0],n.target)||x[0]==n.target)&&n.preventDefault(),r?(n.preventDefault(),x.length>0&&(v=v.each(function(e,n){var i=$(r).find("*[data-id]").attr("data-id");i=i||$(r).attr("data-id"),$(n).find("."+t).attr("data-id",(null==i?"":i).trim())}),x.length>0&&1!==w&&(w=1,x.addClass(e)),function(t){l=function(t){var e=0,n=0;return t||(t=window.event),t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:n}}(t),u=l.x,d=l.y,m=x.outerWidth()+4,h=x.outerHeight()+4,f=window.innerWidth,_=window.innerHeight,f-u<m?$(x).css("left",f-m+"px"):$(x).css("left",u+"px");_-d<h?$(x).css("top",d-h+4+"px"):$(x).css("top",d+"px")}(n))):(r=null,y())}function y(){0!==w&&(w=0,$(x).removeClass(e),$(x).attr("style",""))}$(document).on("lostFocus",function(t){y()}),$(document).on("scroll",function(){y()}),$(document).on("contextmenu",function(t){C(t)}),$(document).on("taphold",function(t){(function(){var t=" -webkit- -moz- -o- -ms- ".split(" ");if("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)return!0;var e=["(",t.join("touch-enabled),("),"heartz",")"].join("");return function(t){return window.matchMedia(t).matches}(e)})()&&C(t)}),$(document).on("click",function(e){var n=a(e,"."+t);if(n&&$(r).is(p)&&x.find(n).length>0)e.preventDefault(),y();else{var i=e.which||e.button;1===i&&y()}}),window.onkeyup=function(t){27===t.keyCode&&y()},window.onresize=function(t){y()}}}